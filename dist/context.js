"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react/jsx-runtime"),t=require("react");const r=t.createContext(null),n=()=>{const e=t.useContext(r);if(!e)throw new Error("useTorchlight must be used within a TorchlightProvider");return e};exports.TorchlightContext=r,exports.TorchlightInternalProvider=({children:n,overlayProps:s={}})=>{const[o,c]=t.useState(new Map),[u,l]=t.useState(null),i=t.useCallback((e,t)=>{c(r=>{const n=new Map(r),s=n.get(e.tourId)||{id:e.tourId,steps:[],currentStepIndex:0,isActive:!1},o=s.steps.findIndex(t=>t.id===e.id),c={...e,target:t};if(-1!==o){const t=s.steps[o];if(t.order===c.order&&t.title===c.title&&t.content===c.content&&t.placement===c.placement&&t.target===c.target)return r;const u=[...s.steps];u[o]=c,u.sort((e,t)=>e.order-t.order),n.set(e.tourId,{...s,steps:u})}else{const t=[...s.steps,c].sort((e,t)=>e.order-t.order);n.set(e.tourId,{...s,steps:t})}return n})},[]),a=t.useCallback((e,t)=>{c(r=>{const n=new Map(r),s=n.get(t);if(!s)return r;const o=s.steps.filter(t=>t.id!==e);return 0===o.length?(n.delete(t),u===t&&l(null)):n.set(t,{...s,steps:o,currentStepIndex:Math.min(s.currentStepIndex,o.length-1)}),n})},[u]),p=t.useCallback(e=>{c(t=>{const r=new Map(t),n=r.get(e);return n?0===n.steps.length?(console.warn(`Tour "${String(e)}" has no steps. Make sure components with steps are mounted.`),t):(r.set(e,{...n,isActive:!0,currentStepIndex:0}),r):(console.warn(`Tour "${String(e)}" not found. Make sure all steps are registered.`),t)}),l(e)},[]),d=t.useCallback(e=>{c(t=>{const r=new Map(t),n=r.get(e);return n&&r.set(e,{...n,isActive:!1}),r}),u===e&&l(null)},[u]),g=t.useCallback(e=>{c(t=>{const r=new Map(t),n=r.get(e);return n?(n.currentStepIndex<n.steps.length-1?r.set(e,{...n,currentStepIndex:n.currentStepIndex+1}):(r.set(e,{...n,isActive:!1}),l(null)),r):t})},[]),h=t.useCallback(e=>{c(t=>{const r=new Map(t),n=r.get(e);return n&&n.currentStepIndex>0&&r.set(e,{...n,currentStepIndex:n.currentStepIndex-1}),r})},[]),S=t.useCallback((e,t)=>{c(r=>{const n=new Map(r),s=n.get(e);return s&&t>=0&&t<s.steps.length&&n.set(e,{...s,currentStepIndex:t}),n})},[]),x=t.useMemo(()=>({tours:o,registerStep:i,unregisterStep:a,startTour:p,stopTour:d,nextStep:g,prevStep:h,goToStep:S,activeTour:u}),[o,i,a,p,d,g,h,S,u]);return e.jsx(r.Provider,{value:x,children:n})},exports.useTorchlight=n,exports.useTorchlightSteps=(e,r)=>{const{registerStep:s,unregisterStep:o}=n(),c=t.useRef({});r.forEach(e=>{c.current[e.id]||(c.current[e.id]={current:null})});const u=t.useRef(""),l=t.useRef(new Set);return t.useEffect(()=>{const t=r.map(e=>`${e.id}:${e.order}:${e.title||""}:${e.placement||""}`).sort().join("|");return u.current!==t&&(r.forEach(t=>{s({id:t.id,tourId:e,order:t.order,title:t.title,content:t.content,placement:t.placement||"bottom"},c.current[t.id]),l.current.add(t.id)}),u.current=t),()=>{l.current.forEach(t=>{o(t,e)}),l.current.clear()}},[e,s,o,r]),t.useEffect(()=>{r.forEach(t=>{s({id:t.id,tourId:e,order:t.order,title:t.title,content:t.content,placement:t.placement||"bottom"},c.current[t.id])})},[r.map(e=>e.content||"").join(""),e,s]),c.current};
//# sourceMappingURL=context.js.map
